(function(){"use strict";self.onmessage=m=>{try{const{width:t,height:s,firstImageData:r,secondImageData:n,showSimilarities:g,showDifferences:h,showBaseImage:f}=m.data;if(!r||!n||r.length!==n.length)throw new Error("Las imágenes no son válidas o no tienen el mismo tamaño.");const o=new Uint8ClampedArray(t*s*4);let a=0;const i=f?128:255,p=new Uint8ClampedArray([0,255,0,i]),d=new Uint8ClampedArray([255,0,0,i]),w=e=>e?g?p:new Uint8ClampedArray([0,0,0,0]):h?d:new Uint8ClampedArray([0,0,0,0]);for(let e=0;e<r.length;e+=4){const l=[0,1,2,3].every(c=>r[e+c]===n[e+c]);l&&a++;const A=w(l);o.set(A,e)}const y=t*s,C=a/y*100,u={comparisonData:o,similarityPercentage:C,width:t,height:s};self.postMessage(u,[o.buffer])}catch(t){console.error("Error en el worker de comparación de imágenes:",t),self.postMessage({error:t.message})}}})();
